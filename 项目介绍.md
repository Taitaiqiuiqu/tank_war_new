# 坦克大战 (Tank War) 项目介绍

## 1. 项目概述
本项目是一个基于 Python 和 Pygame 开发的现代化坦克大战游戏。在保留经典玩法的基础上，增加了局域网联机对战、可视化地图编辑器以及更丰富的视觉特效。项目采用模块化设计，支持单机闯关和双人联机两种模式。

## 2. 技术栈 (Technology Stack)

### 核心技术
*   **编程语言**: Python 3.8+
*   **游戏引擎**: `pygame` (基于 SDL 的 Python 游戏开发库)
*   **GUI 框架**: `pygame_gui` (用于构建主菜单、设置界面和编辑器 UI)

### 网络与数据
*   **网络通信**: Python 标准库 `socket`
    *   **TCP**: 用于游戏核心状态同步和控制指令传输（保证可靠性）
    *   **UDP**: 用于局域网房间广播和发现（实现自动搜寻主机）
*   **数据存储**: JSON 格式
    *   用于存储自定义地图数据 (`.json` 文件)
    *   用于网络传输中的状态序列化

## 3. 架构设计 (Architecture Design)

本项目采用分层架构设计，将游戏逻辑、渲染表现和网络通信分离。

### 3.1 目录结构
```text
project_root/
├── src/
│   ├── game_engine/    # 游戏核心逻辑 (MVC 中的 Model/Controller)
│   │   ├── game.py         # 游戏主循环
│   │   ├── game_world.py   # 游戏世界管理 (实体容器)
│   │   ├── tank.py         # 坦克实体逻辑
│   │   └── ...
│   ├── network/        # 网络通信层
│   │   ├── network_manager.py # Socket 管理与消息队列
│   │   └── ...
│   ├── state_sync/     # 状态同步层
│   │   └── state_manager.py   # 状态快照序列化/反序列化
│   ├── ui/             # 用户界面层 (MVC 中的 View)
│   │   ├── screen_manager.py  # 屏幕管理器
│   │   └── screens/           # 各个游戏场景 (菜单、编辑器等)
│   └── utils/          # 工具类 (资源加载、配置等)
├── maps/               # 地图文件存储
├── assets/             # 游戏素材 (图片、音频)
└── main.py             # 程序入口
```

### 3.2 核心模块设计

#### 游戏引擎 (Game Engine)
*   **GameWorld**: 核心容器，管理所有游戏对象（坦克、子弹、墙体、特效）。负责碰撞检测和物理更新。
*   **Entity System**: 采用面向对象设计，所有可移动物体继承自 `GameObject`，具备统一的渲染和更新接口。

#### 联机架构 (Multiplayer Architecture)
采用 **权威服务器 (Authoritative Server)** 模式，其中主机 (Host) 充当服务器。

*   **通信模型**: C/S 架构 (Client-Server)。
*   **同步机制**:
    *   **快照同步 (Snapshot Sync)**: 主机每帧发送完整的世界状态快照（包括坦克位置、血量、子弹、特效等）。
    *   **客户端预测 (Client-Side Prediction)**: 客户端在本地立即响应玩家输入，同时根据服务器状态进行平滑插值修正，以消除延迟感。
    *   **事件同步**: 对于爆炸、音效、重生等一次性事件，通过状态包中的事件列表进行同步。

#### 地图系统
*   **网格系统**: 地图基于 50x50 像素的网格系统。
*   **可视化编辑器**: 实现了所见即所得的地图编辑器，支持笔刷绘制、橡皮擦、保存/加载功能。

## 4. 主要功能特性

1.  **游戏模式**:
    *   **单机模式**: 包含敌人 AI、多条命机制、关卡流程。
    *   **联机模式**: 支持局域网自动发现，双人同屏战斗，状态实时同步。

2.  **视觉效果**:
    *   粒子特效（爆炸、开火）。
    *   坦克出生护盾与星星特效。
    *   动态分层渲染（草地遮挡效果）。

3.  **音频系统**:
    *   完整的音效反馈（移动、射击、爆炸、待机）。
    *   支持 3D 音效基础（区分玩家与敌人的声音）。
